<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="Barry Wittman, Tim Korb, Aditya Mathur">
<title>Start Concurrent: A Gentle Introduction to Concurrent Programming</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="style0.css" type="text/css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="style1.css" type="text/css">
<link rel="stylesheet" href="asciidoctor-chunker.css" type="text/css"></head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Start Concurrent: A Gentle Introduction to Concurrent Programming</h1>
<div class="details">
<span id="author" class="author">Barry Wittman</span><br>
<span id="email" class="email"><a href="mailto:wittman1@otterbein.edu">wittman1@otterbein.edu</a></span><br>
<span id="author2" class="author">Tim Korb</span><br>
<span id="email2" class="email"><a href="mailto:jtk@purdue.edu">jtk@purdue.edu</a></span><br>
<span id="author3" class="author">Aditya Mathur</span><br>
<span id="email3" class="email"><a href="mailto:apm@purdue.edu">apm@purdue.edu</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="index.html">Attacking Problems with Java</a></li><li><a href="index.html">1. Computer Basics</a>
<ul class="sectlevel2">
<li><a href="index.html#_problem_buying_a_computer">1.1. Problem: Buying a computer</a></li>
<li><a href="index.html#_concepts_hardware_and_software">1.2. Concepts: Hardware and software</a></li>
<li><a href="index.html#_syntax_data_representation">1.3. Syntax: Data representation</a></li>
<li><a href="index.html#_solution_buying_a_computer">1.4. Solution: Buying a computer</a></li>
<li><a href="index.html#_summary">1.5. Summary</a></li>
<li><a href="index.html#_exercises">1.6. Exercises</a></li>
</ul>
</li>
<li><a href="chap2.html">2. Problem Solving and Programming</a>
<ul class="sectlevel2">
<li><a href="chap2.html#_problem_how_to_solve_problems">2.1. Problem: How to solve problems</a></li>
<li><a href="chap2.html#_concepts_developing_software">2.2. Concepts: Developing software</a></li>
<li><a href="chap2.html#_syntax_java_basics">2.3. Syntax: Java basics</a></li>
<li><a href="chap2.html#_solution_how_to_solve_problems">2.4. Solution: How to solve problems</a></li>
<li><a href="chap2.html#_concurrency_solving_problems_in_parallel">2.5. Concurrency: Solving problems in parallel</a></li>
<li><a href="chap2.html#_summary_2">2.6. Summary</a></li>
<li><a href="chap2.html#_exercises_2">2.7. Exercises</a></li>
</ul>
</li>
<li><a href="chap3.html">3. Primitive Types and Strings</a>
<ul class="sectlevel2">
<li><a href="chap3.html#_problem_college_cost_calculator">3.1. Problem: College cost calculator</a></li>
<li><a href="chap3.html#_concepts_types">3.2. Concepts: Types</a></li>
<li><a href="chap3.html#_syntax_types_in_java">3.3. Syntax: Types in Java</a></li>
<li><a href="chap3.html#_syntax_useful_libraries">3.4. Syntax: Useful libraries</a></li>
<li><a href="chap3.html#_solution_college_cost_calculator">3.5. Solution: College cost calculator</a></li>
<li><a href="chap3.html#_concurrency_expressions">3.6. Concurrency: Expressions</a></li>
<li><a href="chap3.html#_summary_3">3.7. Summary</a></li>
<li><a href="chap3.html#_exercises_3">3.8. Exercises</a></li>
</ul>
</li>
<li><a href="chap4.html">4. Selection</a>
<ul class="sectlevel2">
<li><a href="chap4.html#_problem_monty_hall_simulation">4.1. Problem: Monty Hall simulation</a></li>
<li><a href="chap4.html#_concepts_choosing_between_options">4.2. Concepts: Choosing between options</a></li>
<li><a href="chap4.html#_syntax_selection_in_java">4.3. Syntax: Selection in Java</a></li>
<li><a href="chap4.html#_solution_monty_hall">4.4. Solution: Monty Hall</a></li>
<li><a href="chap4.html#_concurrency_selection">4.5. Concurrency: Selection</a></li>
<li><a href="chap4.html#_exercises_4">4.6. Exercises</a></li>
</ul>
</li>
<li><a href="chap5.html">5. Repetition</a>
<ul class="sectlevel2">
<li><a href="chap5.html#_problem_dna_searching">5.1. Problem: DNA searching</a></li>
<li><a href="chap5.html#_concepts_repetition">5.2. Concepts: Repetition</a></li>
<li><a href="chap5.html#_syntax_loops_in_java">5.3. Syntax: Loops in Java</a></li>
<li><a href="chap5.html#_solution_dna_searching">5.4. Solution: DNA searching</a></li>
<li><a href="chap5.html#_concurrency_loops">5.5. Concurrency: Loops</a></li>
<li><a href="chap5.html#_exercises_5">5.6. Exercises</a></li>
</ul>
</li>
<li><a href="chap6.html">6. Arrays</a>
<ul class="sectlevel2">
<li><a href="chap6.html#_introduction">6.1. Introduction</a></li>
<li><a href="chap6.html#_problem_game_of_life">6.2. Problem: Game of Life</a></li>
<li><a href="chap6.html#_concepts_lists_of_data">6.3. Concepts: Lists of data</a></li>
<li><a href="chap6.html#_syntax_arrays_in_java">6.4. Syntax: Arrays in Java</a></li>
<li><a href="chap6.html#_examples_array_usage">6.5. Examples: Array usage</a></li>
<li><a href="chap6.html#_concepts_multidimensional_lists">6.6. Concepts: Multidimensional lists</a></li>
<li><a href="chap6.html#_syntax_advanced_arrays_in_java">6.7. Syntax: Advanced arrays in Java</a></li>
<li><a href="chap6.html#_examples_two_dimensional_arrays">6.8. Examples: Two-dimensional arrays</a></li>
<li><a href="chap6.html#_advanced_special_array_tools_in_java">6.9. Advanced: Special array tools in Java</a></li>
<li><a href="chap6.html#_solution_game_of_life">6.10. Solution: Game of Life</a></li>
<li><a href="chap6.html#_concurrency_arrays">6.11. Concurrency: Arrays</a></li>
<li><a href="chap6.html#_exercises_6">6.12. Exercises</a></li>
</ul>
</li>
<li><a href="chap7.html">7. Simple Graphical User Interfaces</a>
<ul class="sectlevel2">
<li><a href="chap7.html#_problem_codon_extractor">7.1. Problem: Codon extractor</a></li>
<li><a href="chap7.html#GUIBasicsIntroductionSection">7.2. Concepts: User interaction</a></li>
<li><a href="chap7.html#_syntax_dialogs_and_the_joptionpane_class">7.3. Syntax: Dialogs and the <code>JOptionPane</code> class</a></li>
<li><a href="chap7.html#_solution_codon_extractor">7.4. Solution: Codon extractor</a></li>
<li><a href="chap7.html#_concurrency_simple_guis">7.5. Concurrency: Simple GUIs</a></li>
<li><a href="chap7.html#_summary_4">7.6. Summary</a></li>
<li><a href="chap7.html#_exercises_7">7.7. Exercises</a></li>
</ul>
</li>
<li><a href="chap8.html">8. Methods</a>
<ul class="sectlevel2">
<li><a href="chap8.html#_problem_three_card_poker">8.1. Problem: Three card poker</a></li>
<li><a href="chap8.html#_concepts_dividing_work_into_segments">8.2. Concepts: Dividing work into segments</a></li>
<li><a href="chap8.html#_syntax_methods">8.3. Syntax: Methods</a></li>
<li><a href="chap8.html#_examples_defining_methods">8.4. Examples: Defining methods</a></li>
<li><a href="chap8.html#_solution_three_card_poker">8.5. Solution: Three card poker</a></li>
<li><a href="chap8.html#_concurrency_methods">8.6. Concurrency: Methods</a></li>
<li><a href="chap8.html#_exercises_8">8.7. Exercises</a></li>
</ul>
</li>
<li><a href="chap9.html">9. Classes</a>
<ul class="sectlevel2">
<li><a href="chap9.html#_problem_nested_expressions">9.1. Problem: Nested expressions</a></li>
<li><a href="chap9.html#_concepts_object_oriented_programming">9.2. Concepts: Object-oriented programming</a></li>
<li><a href="chap9.html#_syntax_classes_in_java">9.3. Syntax: Classes in Java</a></li>
<li><a href="chap9.html#_advanced_nested_classes">9.4. Advanced: Nested classes</a></li>
<li><a href="chap9.html#_solution_nested_expressions">9.5. Solution: Nested expressions</a></li>
<li><a href="chap9.html#_concurrency_objects">9.6. Concurrency: Objects</a></li>
<li><a href="chap9.html#_exercises_9">9.7. Exercises</a></li>
</ul>
</li>
<li><a href="chap10.html">10. Interfaces</a>
<ul class="sectlevel2">
<li><a href="chap10.html#_problem_sort_it_out">10.1. Problem: Sort it out</a></li>
<li><a href="chap10.html#_concepts_making_a_promise">10.2. Concepts: Making a promise</a></li>
<li><a href="chap10.html#_syntax_interfaces">10.3. Syntax: Interfaces</a></li>
<li><a href="chap10.html#_advanced_local_and_anonymous_classes">10.4. Advanced: Local and anonymous classes</a></li>
<li><a href="chap10.html#_solution_sort_it_out">10.5. Solution: Sort it out</a></li>
<li><a href="chap10.html#_concurrency_interfaces">10.6. Concurrency: Interfaces</a></li>
<li><a href="chap10.html#_exercises_10">10.7. Exercises</a></li>
</ul>
</li>
<li><a href="chap11.html">11. Inheritance</a>
<ul class="sectlevel2">
<li><a href="chap11.html#_problem_boolean_circuits">11.1. Problem: Boolean circuits</a></li>
<li><a href="chap11.html#_concepts_refining_classes">11.2. Concepts: Refining classes</a></li>
<li><a href="chap11.html#_syntax_inheritance_in_java">11.3. Syntax: Inheritance in Java</a></li>
<li><a href="chap11.html#_examples_problem_solving_with_inheritance">11.4. Examples: Problem solving with inheritance</a></li>
<li><a href="chap11.html#_solution_boolean_circuits">11.5. Solution: Boolean circuits</a></li>
<li><a href="chap11.html#_concurrency_inheritance">11.6. Concurrency: Inheritance</a></li>
<li><a href="chap11.html#_exercises_11">11.7. Exercises</a></li>
</ul>
</li>
<li><a href="chap12.html">12. Exceptions</a>
<ul class="sectlevel2">
<li><a href="chap12.html#_problem_bank_burglary">12.1. Problem: Bank burglary</a></li>
<li><a href="chap12.html#_concepts_error_handling">12.2. Concepts: Error handling</a></li>
<li><a href="chap12.html#_syntax_exceptions_in_java">12.3. Syntax: Exceptions in Java</a></li>
<li><a href="chap12.html#_solution_bank_burglary">12.4. Solution: Bank burglary</a></li>
<li><a href="chap12.html#_concurrency_exceptions">12.5. Concurrency: Exceptions</a></li>
<li><a href="chap12.html#_exercises_12">12.6. Exercises</a></li>
</ul>
</li>
<li><a href="chap13.html">13. Concurrent Programming</a>
<ul class="sectlevel2">
<li><a href="chap13.html#_introduction_2">13.1. Introduction</a></li>
<li><a href="chap13.html#_problem_deadly_virus">13.2. Problem: Deadly virus</a></li>
<li><a href="chap13.html#_concepts_splitting_up_work">13.3. Concepts: Splitting up work</a></li>
<li><a href="chap13.html#_syntax_threads_in_java">13.4. Syntax: Threads in Java</a></li>
<li><a href="chap13.html#_examples_concurrency_and_speedup">13.5. Examples: Concurrency and speedup</a></li>
<li><a href="chap13.html#_concepts_thread_scheduling">13.6. Concepts: Thread scheduling</a></li>
<li><a href="chap13.html#_syntax_thread_states">13.7. Syntax: Thread states</a></li>
<li><a href="chap13.html#_solution_deadly_virus">13.8. Solution: Deadly virus</a></li>
<li><a href="chap13.html#_summary_5">13.9. Summary</a></li>
<li><a href="chap13.html#_exercises_13">13.10. Exercises</a></li>
</ul>
</li>
<li><a href="chap14.html">14. Synchronization</a>
<ul class="sectlevel2">
<li><a href="chap14.html#_introduction_3">14.1. Introduction</a></li>
<li><a href="chap14.html#_problem_dining_philosophers">14.2. Problem: Dining philosophers</a></li>
<li><a href="chap14.html#_concepts_thread_interaction">14.3. Concepts: Thread interaction</a></li>
<li><a href="chap14.html#_syntax_thread_synchronization">14.4. Syntax: Thread synchronization</a></li>
<li><a href="chap14.html#_pitfalls_synchronization_challenges">14.5. Pitfalls: Synchronization challenges</a></li>
<li><a href="chap14.html#_solution_dining_philosophers">14.6. Solution: Dining philosophers</a></li>
<li><a href="chap14.html#_exercises_14">14.7. Exercises</a></li>
</ul>
</li>
<li><a href="chap15.html">15. Constructing Graphical User Interfaces</a>
<ul class="sectlevel2">
<li><a href="chap15.html#_problem_math_tutor">15.1. Problem: Math tutor</a></li>
<li><a href="chap15.html#_concepts_graphical_user_interfaces">15.2. Concepts: Graphical user interfaces</a></li>
<li><a href="chap15.html#_syntax_guis_in_java">15.3. Syntax: GUIs in Java</a></li>
<li><a href="chap15.html#_solution_math_tutor">15.4. Solution: Math tutor</a></li>
<li><a href="chap15.html#_concurrency_guis">15.5. Concurrency: GUIs</a></li>
<li><a href="chap15.html#_summary_6">15.6. Summary</a></li>
<li><a href="chap15.html#_exercises_15">15.7. Exercises</a></li>
</ul>
</li>
<li><a href="chap16.html">16. Testing and Debugging</a>
<ul class="sectlevel2">
<li><a href="chap16.html#_fixing_bugs">16.1. Fixing bugs</a></li>
<li><a href="chap16.html#_concepts_approaches_to_debugging">16.2. Concepts: Approaches to debugging</a></li>
<li><a href="chap16.html#_syntax_java_debugging_tools">16.3. Syntax: Java debugging tools</a></li>
<li><a href="chap16.html#_concurrency_parallel_bugs">16.4. Concurrency: Parallel bugs</a></li>
<li><a href="chap16.html#_finding_and_avoiding_bugs">16.5. Finding and avoiding bugs</a></li>
<li><a href="chap16.html#_concepts_design_implementation_and_testing">16.6. Concepts: Design, implementation, and testing</a></li>
<li><a href="chap16.html#_syntax_java_testing_tools">16.7. Syntax: Java testing tools</a></li>
<li><a href="chap16.html#_concurrency_testing_tools">16.8. Concurrency: Testing tools</a></li>
<li><a href="chap16.html#_examples_testing_a_class">16.9. Examples: Testing a class</a></li>
<li><a href="chap16.html#_exercises_16">16.10. Exercises</a></li>
</ul>
</li>
<li class="current"><a href="chap17.html">17. Polymorphism</a>
<ul class="sectlevel2">
<li class="current"><a href="chap17.html#_problem_banking_account_with_a_vengeance">17.1. Problem: Banking account with a vengeance</a></li>
<li class="current"><a href="chap17.html#_concepts_polymorphism">17.2. Concepts: Polymorphism</a></li>
<li class="current"><a href="chap17.html#_syntax_inheritance_tools_in_java">17.3. Syntax: Inheritance tools in Java</a></li>
<li class="current"><a href="chap17.html#_solution_banking_account_with_a_vengeance">17.4. Solution: Banking account with a vengeance</a></li>
<li class="current"><a href="chap17.html#_concurrency_atomic_libraries">17.5. Concurrency: Atomic libraries</a></li>
<li class="current"><a href="chap17.html#_exercises_17">17.6. Exercises</a></li>
</ul>
</li>
<li><a href="chap18.html">18. Dynamic Data Structures</a>
<ul class="sectlevel2">
<li><a href="chap18.html#_problem_infix_conversion">18.1. Problem: Infix conversion</a></li>
<li><a href="chap18.html#_concepts_dynamic_data_structures">18.2. Concepts: Dynamic data structures</a></li>
<li><a href="chap18.html#_syntax_dynamic_arrays_and_linked_lists">18.3. Syntax: Dynamic arrays and linked lists</a></li>
<li><a href="chap18.html#_syntax_abstract_data_types_adt">18.4. Syntax: Abstract data types (ADT)</a></li>
<li><a href="chap18.html#_advanced_generic_data_structures">18.5. Advanced: Generic data structures</a></li>
<li><a href="chap18.html#_solution_infix_conversion">18.6. Solution: Infix conversion</a></li>
<li><a href="chap18.html#_concurrency_linked_lists_and_thread_safety">18.7. Concurrency: Linked lists and thread safety</a></li>
<li><a href="chap18.html#_concurrency_thread_safe_libraries">18.8. Concurrency: Thread-safe libraries</a></li>
<li><a href="chap18.html#_exercises_18">18.9. Exercises</a></li>
</ul>
</li>
<li><a href="chap19.html">19. Recursion</a>
<ul class="sectlevel2">
<li><a href="chap19.html#_problem_maze_of_doom">19.1. Problem: Maze of doom</a></li>
<li><a href="chap19.html#_concepts_recursive_problem_solving">19.2. Concepts: Recursive problem solving</a></li>
<li><a href="chap19.html#_syntax_recursive_methods">19.3. Syntax: Recursive methods</a></li>
<li><a href="chap19.html#_syntax_recursive_data_structures">19.4. Syntax: Recursive data structures</a></li>
<li><a href="chap19.html#_solution_maze_of_doom">19.5. Solution: Maze of doom</a></li>
<li><a href="chap19.html#_concurrency_futures">19.6. Concurrency: Futures</a></li>
<li><a href="chap19.html#_exercises_19">19.7. Exercises</a></li>
</ul>
</li>
<li><a href="chap20.html">20. File I/O</a>
<ul class="sectlevel2">
<li><a href="chap20.html#_problem_a_picture_is_worth_1000_bytes">20.1. Problem: A picture is worth 1,000 bytes</a></li>
<li><a href="chap20.html#_concepts_file_io">20.2. Concepts: File I/O</a></li>
<li><a href="chap20.html#_syntax_file_operations_in_java">20.3. Syntax: File operations in Java</a></li>
<li><a href="chap20.html#_examples_file_examples">20.4. Examples: File examples</a></li>
<li><a href="chap20.html#fileChapterSolution">20.5. Solution: A picture is worth 1,000 bytes</a></li>
<li><a href="chap20.html#_concurrency_file_io">20.6. Concurrency: File I/O</a></li>
<li><a href="chap20.html#_exercises_20">20.7. Exercises</a></li>
</ul>
</li>
<li><a href="chap21.html">21. Network Communication</a>
<ul class="sectlevel2">
<li><a href="chap21.html#_problem_web_server">21.1. Problem: Web server</a></li>
<li><a href="chap21.html#_concepts_tcpip_communication">21.2. Concepts: TCP/IP communication</a></li>
<li><a href="chap21.html#_syntax_networking_in_java">21.3. Syntax: Networking in Java</a></li>
<li><a href="chap21.html#_solution_web_server">21.4. Solution: Web server</a></li>
<li><a href="chap21.html#_concurrency_networking">21.5. Concurrency: Networking</a></li>
<li><a href="chap21.html#_exercises_21">21.6. Exercises</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">





















<div class="sect1">
<h2 id="ch17-polymorphism">17. Polymorphism</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>…​how strange it is to be anything at all.</p>
</div>
</blockquote>
<div class="attribution">
— Neutral Milk Hotel
</div>
</div>
<div class="sect2">
<h3 id="_problem_banking_account_with_a_vengeance">17.1. Problem: Banking account with a vengeance</h3>
<div class="paragraph">
<p>In <a href="chap14.html">Chapter 14</a>, we introduced the
<code>SynchronizedAccount</code> class that guarantees that checking the balance,
making deposits, and making withdrawals will all be safe even in a
multi-threaded environment. Unfortunately, <code>SynchronizedAccount</code> provides
few of the options a full bank account should have. The problem we
present to you now is to create an entire line of bank accounts which
all inherit from <code>SynchronizedAccount</code>. Because of inheritance, all
accounts will at least have <code>getBalance()</code>, <code>deposit()</code>, and
<code>withdraw()</code> methods.</p>
</div>
<div class="paragraph">
<p>You must create three new account classes. The constructor for each
class must take a <code>String</code> which gives the name of the person opening
the account and a <code>double</code> which gives the starting balance of the
account. The first of these classes is <code>CheckingAccount</code>. The rules for
the checking account implemented by this class are simply that the
customer is charged $10 every month that the account is open. The second
class is <code>DirectDepositAccount</code>. This account is very similar to the
basic checking account except that an additional method
<code>directDeposit()</code> has been added. On its own, <code>directDeposit()</code> appears
to operate like <code>deposit()</code>; however, if a direct deposit has been made
in the last month, no service fee will be charged to the account.</p>
</div>
<div class="paragraph">
<p>The <code>SavingsAccount</code> class operates somewhat differently. In addition to
a name and a starting balance, the constructor for a <code>SavingsAccount</code>
takes a <code>double</code> which gives the annual interest rate the account earns.
Each month the balance is checked. If the balance of the account is
greater than $0, the account earns interest corresponding to
1/12 of the annual rate. However, if the balance
is below $1,000, a $25 service fee is charged each month, regardless of
how low the balance becomes.</p>
</div>
<div class="paragraph">
<p>In <a href="chap11.html">Chapter 11</a> you were exposed to concepts
surrounding inheritance in object-oriented programming. We now return
to these concepts and explore them further. In the first place, concurrency
is on the table now, and you must be careful to keep your derived classes
thread safe. In the second, we’ll discuss the full breadth of inheritance.
The tools we describe here are intended to allow you to solve this extended
bank account problem (and indeed many other problems) with as little code as
possible.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_polymorphism">17.2. Concepts: Polymorphism</h3>
<div class="paragraph">
<p>Perhaps the most important reason for inheritance is code reuse. When you
can successfully reuse existing code, you’re not just saving the time
of writing new code. You’re also leveraging the quality and correctness
of the existing code. For example, when you create your own class which
extends <code>Thread</code>, you’re confident that all the thread mechanisms work
properly.</p>
</div>
<div class="paragraph">
<p>You can reuse code by taking a class that does something you like, say
the <code>Racecar</code> class, and enhance it in some way, perhaps so that it
becomes the <code>TurboRacecar</code> class. If you use the <code>TurboRacecar</code> class on
its own, your code reuse is through simple inheritance. If you use
<code>TurboRacecar</code> objects with a <code>RaceTrack</code> class, which was written to
take <code>Racecar</code> objects as input, you’ve entered the realm of
<em>polymorphism</em>. Polymorphism means that the same method can be used on
different types of objects without being rewritten. In Java,
polymorphism works by allowing the programmer to use a child class in
any place where a parent class could have been used.</p>
</div>
<div class="sect3">
<h4 id="_the_is_a_relationship">17.2.1. The is-a relationship</h4>
<div class="paragraph">
<p>Consider the two following class definitions.</p>
</div>
<div id="RacecarProgram" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Racecar</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getTopSpeed</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="mf">200.0</span><span class="o">;</span> <span class="o">}</span>   
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getHorsepower</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="mi">700</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="n">speed</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div id="TurboRacecarProgram" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TurboRacecar</span> <span class="kd">extends</span> <span class="nc">Racecar</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getHorsepower</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="mi">1100</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, imagine that a <code>RaceTrack</code> has an <code>addCar(Racecar car)</code> method
which adds a <code>Racecar</code> to the list of cars on the track. When the cars
begin racing, the <code>RaceTrack</code> object will query the cars to see how much
horsepower they have. A <code>Racecar</code> object will return 700 when
<code>getHorsepower()</code> is called, but a <code>TurboRacecar</code> will return 1100.</p>
</div>
<div class="paragraph">
<p>Even through the <code>TurboRacecar</code> doesn’t have an explicit
<code>getTopSpeed()</code> method, it inherits one from <code>Racecar</code>. Like all derived
classes in Java, <code>TurboRacecar</code> has all the methods and fields that
<code>Racecar</code> does. This relationship is called an <em>is-a</em> relationship
because every <code>TurboRacecar</code> is a <code>Racecar</code> in the sense that you can
use a <code>TurboRacecar</code> whenever a <code>Racecar</code> is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dynamic_binding">17.2.2. Dynamic binding</h4>
<div class="paragraph">
<p>There’s a little bit of magic that makes polymorphism work. When you
compile your code, the <code>RaceTrack</code> doesn’t know which <code>getHorsePower()</code>
method will eventually get called. Only at run time does it query the
object in question and, if it’s a <code>TurboRacecar</code>, use the overridden
method that returns 1100. This feature of Java is called <em>dynamic
binding</em>. Not every object oriented programming language supports
dynamic binding. C++ actually allows the programmer to specify whether
or not a method is dynamically bound.</p>
</div>
<div class="paragraph">
<p>Only methods are dynamically bound in Java. Fields are <em>statically
bound</em>. Consider the following re-definitions of <code>Racecar</code> and
<code>TurboRacecar</code>.</p>
</div>
<div id="StaticRacecarProgram" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StaticRacecar</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">TOP_SPEED</span> <span class="o">=</span> <span class="mf">200.0</span><span class="o">;</span>   
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">HORSEPOWER</span> <span class="o">=</span> <span class="mi">700</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="n">speed</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div id="StaticTurboRacecarProgram" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StaticTurboRacecar</span> <span class="kd">extends</span> <span class="nc">StaticRacecar</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">HORSEPOWER</span> <span class="o">=</span> <span class="mi">1100</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Assume that <code>RaceTrack</code> contains a method which prints out the
horsepower of a <code>StaticRacecar</code> like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">printHorsepower</span><span class="o">(</span><span class="nc">StaticRacecar</span> <span class="n">car</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">car</span><span class="o">.</span><span class="na">HORSEPOWER</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even if you pass an object of type <code>StaticTurboRacecar</code> to the
<code>printHorsepower()</code> method, the value 700 will be printed out every time.
In Java, all fields, whether normal, <code>static</code>, or <code>final</code> are statically bound,
meaning that the <strong>variable</strong> type determines which field will be used at compile
time. In contrast, dynamic binding means that the true type of the <strong>object</strong>
(not the reference variable pointing to it) determines the method that will be
called at run time. Dynamic binding applies only to regular instance methods.
As their name implies, <code>static</code> methods are statically bound, determined at
compile time by reference type.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="chap17.html#staticBindingExercise">Exercise 17.1</a><br>
<a href="chap17.html#staticBindingExampleExercise">Exercise 17.2</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_general_vs_specific">17.2.3. General vs. specific</h4>
<div class="paragraph">
<p>Another way to look at inheritance is as a statement of specialization
and generalization. A <code>TurboRacecar</code> is a specific kind of <code>Racecar</code>
while <code>Racecar</code> is a general category that <code>TurboRacecar</code> belongs to.</p>
</div>
<div class="paragraph">
<p>The rules of Java say that you can always use a more specific version of
a class than you need but never a more general one. You can use a
<code>TurboRacecar</code> any time you need a <code>Racecar</code> but never use a <code>Racecar</code> when
you need a <code>TurboRacecar</code>. A square will do the job of a rectangle, but a
rectangle will not always be suitable when a square is needed.</p>
</div>
<div class="paragraph">
<p>Consider the following two classes:</p>
</div>
<div id="VehicleProgram" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Vehicle</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">travel</span><span class="o">(</span><span class="nc">String</span> <span class="n">destination</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Traveling to "</span> <span class="o">+</span> <span class="n">destination</span> <span class="o">+</span> <span class="s">"!"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div id="RocketShipProgram" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RocketShip</span> <span class="kd">extends</span> <span class="nc">Vehicle</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">blastOff</span><span class="o">()</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"10, 9, 8, 7, 6, 5, 4, 3, 2, 1 *ROAR*"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here’s a method that requires a <code>RocketShip</code> but only uses its
<code>travel()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">takeVacation</span><span class="o">(</span><span class="nc">RocketShip</span> <span class="n">ship</span><span class="o">,</span> <span class="nc">String</span> <span class="n">destination</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ship</span><span class="o">.</span><span class="na">travel</span><span class="o">(</span><span class="n">destination</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It seems as though we should be able to pass any <code>Vehicle</code> to the
<code>takeVacation()</code> method because the only method in <code>ship</code> used by
<code>takeVacation()</code> is <code>travel()</code>. However, the programmer
specified that the parameter should be a <code>RocketShip</code>, and Java plays it
safe. Just because it looks like there won’t be a problem, Java isn’t
going to take any chances on passing an overly general <code>Vehicle</code> when a
<code>RocketShip</code> is required. If Java took chances, a problem could arise if
the <code>takeVacation()</code> method was overridden by a method that did call
<code>ship.blastOff()</code>.</p>
</div>
<div class="paragraph">
<p>In summary, you can pass a <code>RocketShip</code> to a method which takes a
<code>Vehicle</code> or store a <code>RocketShip</code> into an array of <code>Vehicles</code>, but not the
reverse. Java usually gives a compile time error if you try to put
something too general into a location that’s too specific, but there are some
situations which are so tricky that Java doesn’t catch the
error until run time. Arrays, specifically, can cause problems. Examine
the following code snippet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Vehicle</span><span class="o">[]</span> <span class="n">transportation</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RocketShip</span><span class="o">[</span><span class="mi">100</span><span class="o">];</span>
<span class="n">transportation</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Vehicle</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On the first line, we’re using a <code>Vehicle</code> array reference to store an
array of 100 <code>RocketShip</code> references. But, in the second line, we try to store a
<code>Vehicle</code> into an array that’s really a <code>RocketShip</code> array, even though
it looks to the compiler like a <code>Vehicle</code> array. Doing so will compile
but throw an <code>ArrayStoreException</code> at run time.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_inheritance_tools_in_java">17.3. Syntax: Inheritance tools in Java</h3>
<div class="paragraph">
<p>So far, we’ve described polymorphism in Java with a conceptual focus.
In our previous examples, the only language tool needed to use
polymorphism was the <code>extends</code> keyword which you’re now well familiar with.
There are a number of other tools designed to help you structure
class hierarchies and enforce design decisions.</p>
</div>
<div class="sect3">
<h4 id="_abstract_classes_and_methods">17.3.1. Abstract classes and methods</h4>
<div class="paragraph">
<p>One such tool is abstract classes. An abstract class is one which can
<strong>never</strong> be instantiated. In order to use an abstract class, it’s
necessary to make a child class from it. To create an abstract class, you
simply add the <code>abstract</code> keyword to its definition, as in the
following example.</p>
</div>
<div id="UselessProgram" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Useless</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">int</span> <span class="n">variable</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">Useless</span><span class="o">(</span><span class="kt">int</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="n">input</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">variable</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This class is useless for a number of reasons. For one thing, there’s no
way to find out the value of <code>variable</code> except by printing it out.
Furthermore, there’s no way to change the value of <code>variable</code> after the
object’s been created. Finally, since an abstract class can’t be
instantiated, the following code snippet will not compile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Useless</span> <span class="n">thing</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Useless</span><span class="o">(</span><span class="mi">14</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead, we must create a new class that extends <code>Useless</code>.</p>
</div>
<div id="UsefulProgram" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Useful</span> <span class="kd">extends</span> <span class="nc">Useless</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="nf">Useful</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
	<span class="o">}</span>
	
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getVariable</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">variable</span><span class="o">;</span> <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setVariable</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, we can instantiate an object of type <code>Useful</code> and use it for
something.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Useless</span> <span class="n">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Useful</span><span class="o">(</span><span class="mi">14</span><span class="o">);</span>
<span class="n">item</span><span class="o">.</span><span class="na">print</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that, in accordance with the rules of Java, we can store an object
with the more specific type <code>Useful</code> into a reference with the more general
type <code>Useless</code>. Even though Java knows that the object it points to will
never actually be a <code>Useless</code> object, it’s perfectly legal to have a
<code>Useless</code> reference. You can use abstract classes in this way to provide
a base class with some fundamental fields and methods that all other
classes in a particular hierarchy need. By using the keyword <code>abstract</code>,
you’re marking the class as template for other classes instead of as a
class that will be used directly.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="chap17.html#abstractClassesAndInterfacesExercise">Exercise 17.3</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Methods can be abstract as well. If you have an abstract class, you can
create a method header which describes a method that all non-abstract
children classes must implement, as shown below.</p>
</div>
<div id="SequenceProgram" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Sequence</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">int</span> <span class="n">number</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">CONSTANT</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">Sequence</span><span class="o">(</span><span class="kt">int</span> <span class="n">number</span><span class="o">,</span> <span class="kt">int</span> <span class="n">constant</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">;</span>
        <span class="no">CONSTANT</span> <span class="o">=</span> <span class="n">constant</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">int</span> <span class="nf">getNextValue</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This abstract class is supposed to be a template for classes which can
produce some sequence of numbers. Note that there’s no body for the
<code>getNextValue()</code> method. It simply ends with a semicolon. Every
non-abstract derived class must implement a <code>getNextValue()</code> method to
produce the next number in the sequence. For example, we could implement
an arithmetic or a geometric sequence as follows.</p>
</div>
<div id="ArithmeticSequenceProgram" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArithmeticSequence</span> <span class="kd">extends</span> <span class="nc">Sequence</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="nf">ArithmeticSequence</span><span class="o">(</span><span class="kt">int</span> <span class="n">firstTerm</span><span class="o">,</span> <span class="kt">int</span> <span class="n">difference</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span><span class="n">firstTerm</span><span class="o">,</span> <span class="n">difference</span><span class="o">);</span>
	<span class="o">}</span>	
	
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNextValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">number</span> <span class="o">+=</span> <span class="no">CONSTANT</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">number</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div id="GeometricSequenceProgram" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GeometricSequence</span> <span class="kd">extends</span> <span class="nc">Sequence</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="nf">GeometricSequence</span><span class="o">(</span><span class="kt">int</span> <span class="n">firstTerm</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ratio</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span><span class="n">firstTerm</span><span class="o">,</span> <span class="n">ratio</span><span class="o">);</span>
	<span class="o">}</span>
	
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNextValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">number</span> <span class="o">*=</span> <span class="no">CONSTANT</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">number</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Sequence</code> class doesn’t specify <strong>how</strong> the sequence of numbers
should be generated, but any derived class must implement the
<code>getNextValue()</code> method in order to compile. By using an abstract class,
we don’t have to create a base class which generates a meaningless
sequence of numbers just for the sake of establishing the
<code>getNextValue()</code> method. Abstract classes are like interfaces in that they
can force the programmer who’s extending them to implement particular methods,
but unlike interfaces they can also define fields and methods of any kind.</p>
</div>
<div class="exampleblock">
<div class="title">Example 17.1 Bank account abstract class</div>
<div class="content">
<div class="paragraph">
<p>Here’s a more involved example of an abstract class that gives a first
step toward solving the bank account with a vengeance problem posed at
the beginning of the chapter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kn">import</span> <span class="nn">java.util.Calendar</span><span class="o">;</span> <i class="conum" data-value="1"></i><b>(1)</b>

<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">BankAccount</span> <span class="kd">extends</span> <span class="nc">SynchronizedAccount</span> <span class="o">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Calendar</span> <span class="n">lastAccess</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">monthsPassed</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first step is to import the <code>Calendar</code> class for some date tools
we’re going to use later.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We extend <code>SynchronizedAccount</code> and declare the new class to be
abstract. In this example, we don’t use any abstract methods, but
since each bank account has unique characteristics, we don’t want people
to be able to create a generic <code>BankAccount</code>.</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">    <span class="kd">public</span> <span class="nf">BankAccount</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">double</span> <span class="n">balance</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="n">changeBalance</span><span class="o">(</span><span class="n">balance</span><span class="o">);</span>
        <span class="n">lastAccess</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>        
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">name</span><span class="o">;</span> <span class="o">}</span>
    
    <span class="kd">protected</span> <span class="nc">Calendar</span> <span class="nf">getLastAccess</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">lastAccess</span><span class="o">;</span> <span class="o">}</span>
    
    <span class="kd">protected</span> <span class="kt">int</span> <span class="nf">getMonthsPassed</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">monthsPassed</span><span class="o">;</span> <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The constructor and the accessors should be what you expect to see. Note
that calling the static method <code>Calendar.getInstance()</code> is the correct
way to get a <code>Calendar</code> object with the current date and time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">double</span> <span class="nf">getBalance</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>      
        <span class="n">update</span><span class="o">();</span>       
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">getBalance</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">deposit</span><span class="o">(</span><span class="kt">double</span> <span class="n">amount</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="n">update</span><span class="o">();</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">deposit</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>        
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">withdraw</span><span class="o">(</span><span class="kt">double</span> <span class="n">amount</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="n">update</span><span class="o">();</span>       
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">withdraw</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
    <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then come the balance checking and changing methods. Each calls its parent
method after calling an <code>update()</code> method we discuss below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">    <span class="kd">protected</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">Calendar</span> <span class="n">current</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">months</span> <span class="o">=</span> <span class="mi">12</span><span class="o">*(</span><span class="n">current</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">YEAR</span><span class="o">)</span> <span class="o">-</span>
			<span class="n">lastAccess</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">YEAR</span><span class="o">))</span> <span class="o">+</span> <span class="o">(</span><span class="n">current</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">MONTH</span><span class="o">)</span> <span class="o">-</span>
			<span class="n">lastAccess</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">MONTH</span><span class="o">));</span>
        <span class="k">if</span><span class="o">(</span><span class="n">months</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">lastAccess</span> <span class="o">=</span> <span class="n">current</span><span class="o">;</span>
			<span class="n">monthsPassed</span> <span class="o">=</span> <span class="n">months</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>   </code></pre>
</div>
</div>
<div class="paragraph">
<p>Other than adding <code>String</code> for a name associated with the account, the
<code>update()</code> method is the other major addition made in <code>BankAccount</code>.
Each time <code>update()</code> is called, the number of months since the last
access is stored in the field <code>monthsPast</code> and the timestamp of the last
access is stored in <code>lastAccess</code>. We didn’t need these time features
before, but issues like earning interest or paying monthly service
charges will make them necessary. This method is synchronized so that
the two fields associated with the last access are updated atomically.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_final_classes_and_methods">17.3.2. Final classes and methods</h4>
<div class="paragraph">
<p>If you look at the previous example carefully, you’ll notice that the
methods <code>getBalance()</code>, <code>deposit()</code>, and <code>withdraw()</code> were each declared
with the keyword <code>final</code>. You’ve seen this keyword used to declare
constants before. The meaning that <code>final</code> has for methods is similar to
what it means for constants (and almost the opposite of <code>abstract</code>). A method
which is declared <code>final</code> can’t be overridden by child classes. If you’re
designing a class hierarchy and you want to lock a method into doing a
specific thing and never changing, this is the way to do it.</p>
</div>
<div class="paragraph">
<p>Like <code>abstract</code>, the keyword <code>final</code> can be applied to a class as well.
If you want to prevent a class from being extended further, apply the
<code>final</code> keyword to its definition. You might not find yourself using this
feature of Java very often. It’s primarily useful in situations where a
large body of code has been designed to make use of a specific class.
Making child classes from that class could cause unexpected problems.</p>
</div>
<div class="paragraph">
<p>The most common example of a <code>final</code> class is the <code>String</code> class.
Consider the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SuperString</span> <span class="kd">extends</span> <span class="nc">String</span> <span class="o">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code will give a compiler error. <code>String</code> is perfect the way it is
(or so the Java designers have decided). Use of the <code>final</code> keyword for
classes, methods, and especially to specify constants allows the compiler to do
performance optimizations that would otherwise be impossible.</p>
</div>
</div>
<div class="sect3">
<h4 id="_casting_2">17.3.3. Casting</h4>
<div class="paragraph">
<p>Polymorphism gives us greater power and flexibility when writing code. For
example, we can make a <code>Vehicle</code> array and store child class objects of
<code>Vehicle</code> inside, like so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Vehicle</span><span class="o">[]</span> <span class="n">vehicles</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Vehicle</span><span class="o">[</span><span class="mi">5</span><span class="o">];</span>
<span class="n">vehicles</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Skateboard</span><span class="o">();</span>
<span class="n">vehicles</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RocketShip</span><span class="o">();</span>
<span class="n">vehicles</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SteamBoat</span><span class="o">();</span>
<span class="n">vehicles</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Car</span><span class="o">();</span>
<span class="n">vehicles</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Skateboard</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This process could be infinitely more complex. We could be reading data
out of a file and dynamically creating different kinds of <code>Vehicle</code>
objects, but the final product of an array of <code>Vehicle</code> objects is the
important thing. Now, we can run through the array with a loop and have
the code magically work for each kind of <code>Vehicle</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">vehicles</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
    <span class="n">vehicles</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">travel</span><span class="o">(</span><span class="s">"Prague"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each <code>Vehicle</code> will travel to Prague as it should. The only trouble is
that we’ve hidden some information from the compiler. We know that
<code>vehicles[1]</code> is a <code>RocketShip</code>, but we can’t treat it like one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">vehicles</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="na">blastOff</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code won’t compile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">RocketShip</span> <span class="n">ship</span> <span class="o">=</span> <span class="n">vehicles</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code won’t compile either. In both cases, we must use an
explicit cast to tell the compiler that the object really <strong>is</strong> a
<code>RocketShip</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="o">((</span><span class="nc">RocketShip</span><span class="o">)</span><span class="n">vehicles</span><span class="o">[</span><span class="mi">1</span><span class="o">]).</span><span class="na">blastOff</span><span class="o">();</span>
<span class="nc">RocketShip</span> <span class="n">ship</span> <span class="o">=</span> <span class="o">(</span><span class="nc">RocketShip</span><span class="o">)</span><span class="n">vehicles</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, both lines of code work. The compiler is always conservative. It
never makes guesses about the type of something. Consider the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Vehicle</span> <span class="n">ship</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RocketShip</span><span class="o">();</span>
<span class="n">ship</span><span class="o">.</span><span class="na">blastOff</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though <code>ship</code> <strong>must</strong> be a <code>RocketShip</code>, Java doesn’t assume that it is.
The compiler uses the reference type <code>Vehicle</code> to do the check and will
refuse to compile. Casting allows us to use our human insights to
overcome the shortsightedness of the compiler. Unfortunately, there’s no
guarantee that human insights are correct. What happens if you cast improperly?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Vehicle</span> <span class="n">vehicle</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Skateboard</span><span class="o">();</span>
<span class="nc">RocketShip</span> <span class="n">ship</span> <span class="o">=</span> <span class="o">(</span><span class="nc">RocketShip</span><span class="o">)</span><span class="n">vehicle</span><span class="o">;</span>
<span class="n">ship</span><span class="o">.</span><span class="na">blastOff</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we’re trying to cast a <code>Skateboard</code> into a
<code>RocketShip</code>. At compile time, no errors will be found. Because we use
explicit casting, the compiler assumes that we, powerful human beings
that we are, know what we’re doing. The error will happen at run time
while executing the second line. Java will try to cast <code>vehicle</code> into a
<code>RocketShip</code>, fail, and throw a <code>ClassCastException</code>.</p>
</div>
<div class="paragraph">
<p>Java provides some additional tools to make casting easier. One of these
is the <code>instanceof</code> keyword which can be used to test if an object is an
instance of a particular class (or one of its derived classes). For
example, we can make an object execute a special command if we know that
the object is capable of it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">visitDenver</span><span class="o">(</span><span class="nc">Vehicle</span> <span class="n">vehicle</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">vehicle</span> <span class="k">instanceof</span> <span class="nc">RocketShip</span><span class="o">)</span>
        <span class="o">((</span><span class="nc">RocketShip</span><span class="o">)</span><span class="n">vehicle</span><span class="o">).</span><span class="na">blastOff</span><span class="o">();</span>
    <span class="n">vehicle</span><span class="o">.</span><span class="na">travel</span><span class="o">(</span><span class="s">"Denver"</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even inside this <code>if</code> statement where it <strong>must</strong> be the case that <code>vehicle</code>
is a <code>RocketShip</code>, we still must perform an explicit cast. Sometimes
<code>instanceof</code> is not precise enough. If you must be sure that the object
in question is a particular class and not just one of its child classes, you
can use the <code>getClass()</code> method on any object and compare it to the
static class object. Using this tool, we can rewrite the former example
to be more specific.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">visitDenver</span><span class="o">(</span><span class="nc">Vehicle</span> <span class="n">vehicle</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">vehicle</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span> <span class="o">==</span>  <span class="nc">RocketShip</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="o">((</span><span class="nc">RocketShip</span><span class="o">)</span><span class="n">vehicle</span><span class="o">).</span><span class="na">blastOff</span><span class="o">();</span>
    <span class="n">vehicle</span><span class="o">.</span><span class="na">travel</span><span class="o">(</span><span class="s">"Denver"</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This version of the code will only call <code>blastOff()</code> for objects of
class <code>RocketShip</code> and not for objects of a child class like
<code>FusionPoweredRocketShip</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="chap17.html#instanceofExercise">Exercise 17.6</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inheritance_and_exceptions">17.3.4. Inheritance and exceptions</h4>
<div class="paragraph">
<p>Beyond <code>ClassCastException</code>, there are a few other issues that come up
when combining exceptions with inheritance. As you already know, an
exception handler for a parent class will work for a child class. As
such, when using multiple exception handlers, it’s necessary to order
them from most specific to most general in terms of class hierarchy.</p>
</div>
<div class="paragraph">
<p>However, there’s another subtle rule that’s necessary to keep
polymorphism functioning smoothly. Let’s consider a <code>Fruit</code> class with
an <code>eat()</code> method that throws an <code>UnripeFruitException</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Fruit</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">eat</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">UnripeFruitException</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Almost any fruit can be unripe, and it can be unpleasant to try to eat such
a fruit. But there are other things that can go wrong when eating
fruit. Consider the <code>Plum</code> class derived from <code>Fruit</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Plum</span> <span class="kd">extends</span> <span class="nc">Fruit</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">eat</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">UnripeFruitException</span><span class="o">,</span> <span class="nc">ChokingOnPitException</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>Plum</code> class, the <code>eat()</code> method has been overridden to tackle
the special ways that eating a plum is different from eating fruit in
general. When eating a plum, you can make a mistake and try to swallow
the pit, throwing, it seems, a <code>ChokingOnPitException</code>. This scenario
seems natural, but it’s <strong>not</strong> allowed in Java.</p>
</div>
<div class="paragraph">
<p>The principle behind polymorphism is that a more specialized version of
something can <strong>always</strong> be used in place of a more general version. Indeed,
if you use a <code>Plum</code> in place of a <code>Fruit</code>, calling the <code>eat()</code> method is no
problem. The problem only happens if a <code>ChokingOnPitException</code> is thrown.
Code that was designed for <code>Fruit</code> objects knows nothing about a
<code>ChokingOnPitException</code>, so there’s no way for such code to catch the
exception and deal with the situation.</p>
</div>
<div class="paragraph">
<p>There’s nothing wrong with throwing exceptions on overridden methods.
The rule is that the overriding method must throw a subset of the exceptions
that the overridden method throws. This subset doesn’t need to be a proper
subset, so it could be all, some, or none of the exceptions thrown by the
overridden method. This rule demonstrates a concept called Hoare’s rule of
consequence that pops up many times in programming language design. Essentially,
if you start with something that works, you can tighten the requirements on
the input (using a <code>Plum</code> instead of any <code>Fruit</code>) and loosen the requirements
on the output (throwing fewer exceptions than were originally thrown), and it
will still work.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="chap17.html#polymorphismExceptionsExercise">Exercise 17.7</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 17.2 More human than human</div>
<div class="content">
<div class="paragraph">
<p>Here we have a few additional examples in a somewhat larger class
hierarchy.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/17-polymorphism/images/animals.svg" alt="animals" width="75%">
</div>
<div class="title">Figure 17.1 Animal class hierarchy.</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Animal</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">alive</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">happy</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">warmBlooded</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">Animal</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">warmBlooded</span><span class="o">)</span> <span class="o">{</span>      
        <span class="k">this</span><span class="o">.</span><span class="na">warmBlooded</span> <span class="o">=</span> <span class="n">warmBlooded</span><span class="o">;</span>
    <span class="o">}</span>   
        
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isHappy</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">happy</span><span class="o">;</span> <span class="o">}</span>  
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHappy</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="n">happy</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>        
    
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAlive</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">alive</span><span class="o">;</span> <span class="o">}</span>  
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">die</span><span class="o">()</span> <span class="o">{</span> <span class="n">alive</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="o">}</span>    
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We begin with the abstract <code>Animal</code> class. This class gives a base
definition for animals which includes whether the animal is alive,
whether the animal is happy, and whether it’s warm-blooded (declared
<code>final</code> because an animal can’t switch between warm-blooded and
cold-blooded).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Mammal</span> <span class="kd">extends</span> <span class="nc">Animal</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="no">MALE</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="no">FEMALE</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">gender</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">Mammal</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">gender</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">gender</span> <span class="o">=</span> <span class="n">gender</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">getGender</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">gender</span><span class="o">;</span> <span class="o">}</span>   

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="nc">String</span> <span class="nf">makeSound</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We then extend <code>Animal</code> into <code>Mammal</code>. All mammals are warm-blooded,
which is reflected in the constructor call to the base class. In
addition, it’s assumed that all mammals make some sound. Mammals generally
also have well-defined genders. Like <code>Animal</code>, <code>Mammal</code> is an abstract class,
and any non-abstract child of <code>Mammal</code> must implement <code>makeSound()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Platypus</span> <span class="kd">extends</span> <span class="nc">Mammal</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">Platypus</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">gender</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">gender</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">makeSound</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Quack!"</span><span class="o">;</span>
    <span class="o">}</span>   
    
    <span class="kd">public</span> <span class="nc">Egg</span> <span class="nf">layEgg</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">getGender</span><span class="o">()</span> <span class="o">==</span> <span class="no">FEMALE</span><span class="o">)</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">Egg</span><span class="o">();</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">poison</span><span class="o">(</span><span class="nc">Animal</span> <span class="n">victim</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">getGender</span><span class="o">()</span> <span class="o">==</span> <span class="no">MALE</span><span class="o">)</span>
            <span class="n">victim</span><span class="o">.</span><span class="na">setHappy</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>                           
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Platypus</code> class extends <code>Mammal</code> and adds the unusual things that a
platypus can do: laying eggs (if female) and poisoning other animals (if
male).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Human</span> <span class="kd">extends</span> <span class="nc">Mammal</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">Human</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">gender</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">happy</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">gender</span><span class="o">);</span>
        <span class="n">setHappy</span><span class="o">(</span><span class="n">happy</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">makeSound</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Hello, world."</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Human</code> class also extends <code>Mammal</code>. Depending on the problem being
solved, this class might warrant a great deal more specialization. Right
now the main addition is taking happiness as an argument to the
constructor since the default human state is not necessarily happiness.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">DavidBowie</span> <span class="kd">extends</span> <span class="nc">Human</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">DavidBowie</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="no">MALE</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>                
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">makeSound</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"I always had a repulsive need to be something more than human."</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the <code>DavidBowie</code> class extends <code>Human</code> and is declared a final
class because it’s impossible to add anything to David Bowie.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Our examples have stretched fairly long in this
chapter. It’s difficult to give strong motivation for some aspects of
inheritance and polymorphism without a large class hierarchy. These
tools are designed to help organize large bodies of code and should
become more useful as the size of the problem you’re working on grows.
One of the best examples of the success of inheritance is the Java API
itself. The standard Java library is large and depends on inheritance a
great deal.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_banking_account_with_a_vengeance">17.4. Solution: Banking account with a vengeance</h3>
<div class="paragraph">
<p>Now, we return to the specific problem given at the beginning of the
chapter and give its solution. We’ve already given you the
<code>BankAccount</code> abstract class which provides a lot of structure.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/17-polymorphism/images/accounts.svg" alt="accounts" width="75%">
</div>
<div class="title">Figure 17.2 Bank account class hierarchy.</div>
</div>
<div id="CheckingAccountProgram" class="listingblock">
<div class="title">Program 17.1 Child class of <code>BankAccount</code> that models a normal checking account.</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CheckingAccount</span> <span class="kd">extends</span> <span class="nc">BankAccount</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">FEE</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">CheckingAccount</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">double</span> <span class="n">balance</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">balance</span><span class="o">);</span>             
    <span class="o">}</span>
    
    <span class="kd">protected</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">update</span><span class="o">();</span>
        <span class="n">changeBalance</span><span class="o">(-</span><span class="n">getFee</span><span class="o">()*</span><span class="n">getMonthsPassed</span><span class="o">());</span>
    <span class="o">}</span>
    
    <span class="kd">protected</span> <span class="kt">double</span> <span class="nf">getFee</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="no">FEE</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The most basic account is the <code>CheckingAccount</code>. As you recall from the
<code>BankingAccount</code> class, the <code>getBalance()</code>, <code>deposit()</code>, and
<code>withdraw()</code> methods are all declared <code>final</code>. At first it seems as if
there’s no way to change these methods to add the $10 service charge.
However, each of those methods calls the <code>update()</code> method first to take
care of any bookkeeping. By overriding the <code>update()</code> method, we can
easily add the service charge. The new <code>update()</code> method calls the
parent <code>update()</code> to calculate the passage of time, then it changes the
balance based on the number of months that have passed.</p>
</div>
<div class="paragraph">
<p>The system we’ve adopted may seem unusual at first. Any time the
balance is checked, deposited to, or withdrawn from, we call <code>update()</code>.
By updating the account to reflect any months which may have passed
before continuing on, we don’t have to write code which periodically
updates each bank account. Each bank account is only updated if needed.</p>
</div>
<div class="paragraph">
<p>We were careful to mark <code>update()</code> as <code>synchronized</code>. Although the
chance of an error happening is small, we make the update of the
internal <code>Calendar</code> and the application of any fee atomic, just to be
safe.</p>
</div>
<div class="paragraph">
<p>Note that we don’t use the constant <code>FEE</code> directly in <code>update()</code>.
Instead, we call the <code>getFee()</code> method. The reason for this decision is
due to the next class.</p>
</div>
<div id="DirectDepositAccountProgram" class="listingblock">
<div class="title">Program 17.2 Child class of <code>CheckingAccount</code> that models the behavior of accounts with direct deposits.</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kn">import</span> <span class="nn">java.util.Calendar</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DirectDepositAccount</span> <span class="kd">extends</span> <span class="nc">CheckingAccount</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="nc">Calendar</span> <span class="n">lastDirectDeposit</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">DirectDepositAccount</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">double</span> <span class="n">balance</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">balance</span><span class="o">);</span>
        <span class="n">lastDirectDeposit</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getFee</span><span class="o">()</span> <span class="o">{</span>        
        <span class="nc">Calendar</span> <span class="n">current</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">months</span> <span class="o">=</span> <span class="mi">12</span><span class="o">*(</span><span class="n">current</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">YEAR</span><span class="o">)</span> <span class="o">-</span>
        <span class="n">lastDirectDeposit</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">YEAR</span><span class="o">))</span> <span class="o">+</span>
        <span class="o">(</span><span class="n">current</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">MONTH</span><span class="o">)</span> <span class="o">-</span>
        <span class="n">lastDirectDeposit</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">MONTH</span><span class="o">));</span>
        <span class="k">if</span><span class="o">(</span><span class="n">months</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">getFee</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">directDeposit</span><span class="o">(</span><span class="kt">double</span> <span class="n">amount</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="n">deposit</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
        <span class="n">lastDirectDeposit</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DirectDepositAccount</code> class extends the <code>CheckingAccount</code> class.
Note that the <code>update()</code> method hasn’t been overridden. We’ve added
another <code>Calendar</code> object to keep track of the last time a direct
deposit was made. Then, we override the <code>getFee()</code> method. If there’s
been a recent direct deposit, the fee is nothing; otherwise, it
returns the fee from the <code>CheckingAccount</code>. Because of dynamic binding,
the <code>update()</code> method defined in <code>CheckingAccount</code> will call this
overridden <code>getFee()</code> method for <code>DirectDepositAccount</code> objects.</p>
</div>
<div id="SavingsAccountProgram" class="listingblock">
<div class="title">Program 17.3 Child class of <code>BankAccount</code> that models the behavior of a savings account.</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SavingsAccount</span> <span class="kd">extends</span> <span class="nc">BankAccount</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">MINIMUM</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">FEE</span> <span class="o">=</span> <span class="mi">25</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">RATE</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SavingsAccount</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">double</span> <span class="n">balance</span><span class="o">,</span> <span class="kt">double</span> <span class="n">rate</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">balance</span><span class="o">);</span>
        <span class="no">RATE</span> <span class="o">=</span> <span class="n">rate</span><span class="o">;</span>        
    <span class="o">}</span>
    
    <span class="kd">protected</span> <span class="kt">double</span> <span class="nf">getFee</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="no">FEE</span><span class="o">;</span> <span class="o">}</span>
    
    <span class="kd">protected</span> <span class="kt">double</span> <span class="nf">getMinimum</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="no">MINIMUM</span><span class="o">;</span> <span class="o">}</span>
    
    <span class="kd">protected</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">update</span><span class="o">();</span> 
        <span class="kt">int</span> <span class="n">months</span> <span class="o">=</span> <span class="n">getMonthsPassed</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">months</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">getBalance</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
                <span class="n">changeBalance</span><span class="o">(</span><span class="n">getBalance</span><span class="o">()</span> <span class="o">*</span> <span class="o">(</span><span class="mi">1</span> <span class="o">+</span> <span class="no">RATE</span><span class="o">/</span><span class="mi">12</span><span class="o">));</span>
            <span class="k">if</span><span class="o">(</span><span class="n">getBalance</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">getMinimum</span><span class="o">())</span>
                <span class="n">changeBalance</span><span class="o">(-</span><span class="n">getFee</span><span class="o">());</span>
        <span class="o">}</span>               
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There should be few surprises in the last class, <code>SavingsAccount</code>. The
biggest difference is that we use a loop in the <code>update()</code> method to
update the balance because the account could be gaining interest and
also incurring fees. The interaction of the two operations might give a
different result than applying each in a block for the backlog of
months.</p>
</div>
<div class="paragraph">
<p>This set of classes might not resemble the way a real, commercial-grade
banking application works. Nevertheless, with inheritance and
polymorphism we were able to create bank accounts which do some
complicated tasks with a relatively small amount of code. At the same
time, we preserved thread safety so that these accounts can be used in
concurrent environments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_atomic_libraries">17.5. Concurrency: Atomic libraries</h3>
<div class="paragraph">
<p>This chapter has discussed using polymorphism to reuse code. To solve
the banking account with a vengeance problem from the beginning of the
chapter, we explored the process of extending several bank account
classes to add additional features while working hard to maintain thread
safety.</p>
</div>
<div class="paragraph">
<p>Code can be reused by extending classes with child classes or by using
instances of existing classes as fields. There’s no single solution
that’s best for every case. As in the bank account examples, it can be
difficult to know when to apply the <code>synchronized</code> keyword to methods.</p>
</div>
<div class="paragraph">
<p>To lessen the load on the programmer, the Java API provides a library of
atomic primitives in the <code>java.util.concurrent.atomic</code> package. These are
classes with certain operations guaranteed to execute atomically. For example,
the <code>AtomicInteger</code> class encapsulates the functionality of an <code>int</code> variable
with atomic accesses. One of its methods is <code>incrementAndGet()</code>, which will
atomically increment its internal value by 1 and return the result. Recall from
<a href="chap14.html#RaceConditionProgram">Program 14.1</a> that even an operation as simple as
<code>++</code> isn’t atomic. If many different threads try to increment a single
variable, some of those increments can get lost, causing the final value
to be less than it should be.</p>
</div>
<div class="exampleblock">
<div class="title">Example 17.3 AtomicInteger</div>
<div class="content">
<div class="paragraph">
<p>We can use the <code>AtomicInteger</code> class to rewrite
<a href="chap14.html#RaceConditionProgram">Program 14.1</a> so that no race condition occurs.</p>
</div>
<div id="NoRaceConditionProgram" class="listingblock">
<div class="title">Program 17.4 Demonstrates the use of <code>AtomicInteger</code>.</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kn">import</span> <span class="nn">java.util.concurrent.atomic.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoRaceCondition</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>       
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">AtomicInteger</span> <span class="n">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicInteger</span><span class="o">();</span> 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">THREADS</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span>    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">COUNT</span> <span class="o">=</span> <span class="mi">1000000</span><span class="o">;</span>        
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>                              
        <span class="nc">NoRaceCondition</span><span class="o">[]</span> <span class="n">threads</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoRaceCondition</span><span class="o">[</span><span class="no">THREADS</span><span class="o">];</span>           
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="no">THREADS</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoRaceCondition</span><span class="o">();</span>
            <span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">start</span><span class="o">();</span>         
        <span class="o">}</span>           
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="no">THREADS</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                <span class="n">threads</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">join</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">catch</span><span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>           
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Counter:\t"</span> <span class="o">+</span> <span class="n">counter</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>          
    <span class="o">}</span>   
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span> 
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="no">COUNT</span> <span class="o">/</span> <span class="no">THREADS</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="n">counter</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This program is identical to <a href="chap14.html#RaceConditionProgram">Program 14.1</a>, except
that the type of <code>counter</code> has been changed from <code>int</code> to
<code>AtomicInteger</code> (and an appropriate <code>import</code> has been added).
Consequently, the <code>++</code> operation was changed to an <code>incrementAndGet()</code>
method call, and a <code>get()</code> method call was needed to get the final
value. If you run this program, the final answer should always be
1,000,000, no matter what.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="chap17.html#atomicClassExercise">Exercise 17.10</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>java.util.concurrent.atomic</code> package includes <code>AtomicBoolean</code> and
<code>AtomicLong</code> as well as <code>AtomicInteger</code>. Likewise, the
<code>AtomicIntegerArray</code> and <code>AtomicLongArray</code> classes are included to
perform atomic array accesses. For general purposes, the
<code>AtomicReference&lt;V&gt;</code> class provides an atomic way to store a reference
to any object. The <code>&lt;V&gt;</code> is a generic type parameter, which will be
discussed in <a href="chap18.html">Chapter 18</a>.</p>
</div>
<div class="paragraph">
<p>Although you could use the <code>synchronized</code> keyword to create each one of
these classes yourself, the result wouldn’t be as efficient. The atomic
classes use a special <em>lock-free</em> mechanism. Unlike the <code>synchronized</code>
keyword which forces a thread to acquire a lock on a specific object,
lock-free mechanisms are built on a <em>compare-and-swap</em> (CAS) hardware
instruction. Thus, incrementing and the handful of other ways to update an
atomic variable execute in one step because of special instructions on the
CPU. Since there’s no waiting to acquire a lock or fighting over which thread
has the lock, the operation is very fast. Many high performance concurrent
applications depends on CAS implementations.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="chap17.html#atomicTimingExercise">Exercise 17.11</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_17">17.6. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="staticBindingExercise"></a> Explain the difference between static binding and dynamic binding. In which
situations does each apply?</p>
</li>
<li>
<p><a id="staticBindingExampleExercise"></a> Consider the following two classes.</p>
<div id="SaleProgram" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sale</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="n">discount</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getDiscount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">discount</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDiscount</span><span class="o">(</span><span class="kt">double</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">discount</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div id="BlowoutProgram" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Blowout</span> <span class="kd">extends</span> <span class="nc">Sale</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="n">discount</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getDiscount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">discount</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDiscount</span><span class="o">(</span><span class="kt">double</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">discount</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the following snippet of code, what’s the output and why?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Sale</span> <span class="n">sale</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Blowout</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sale</span><span class="o">.</span><span class="na">discount</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sale</span><span class="o">.</span><span class="na">getDiscount</span><span class="o">);</span>
<span class="nc">Blowout</span> <span class="n">blowout</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Blowout</span><span class="o">)</span><span class="n">sale</span><span class="o">;</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">blowout</span><span class="o">.</span><span class="na">discount</span><span class="o">);</span>
<span class="n">sale</span><span class="o">.</span><span class="na">setDiscount</span><span class="o">(</span><span class="mf">0.75</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sale</span><span class="o">.</span><span class="na">discount</span><span class="o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="abstractClassesAndInterfacesExercise"></a> What are the differences and similarities between abstract classes
and interfaces?</p>
</li>
<li>
<p>Assume that the <code>Corn</code>, <code>Carrot</code>, and <code>Potato</code> classes are all
derived from <code>Vegetable</code>. Both <code>Carrot</code> and <code>Potato</code> classes have a
<code>peel()</code> method, but <code>Corn</code> does not. Examine the following code and
identify which line will cause an error and why.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Vegetable</span><span class="o">[]</span> <span class="n">vegetables</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Vegetable</span><span class="o">[</span><span class="mi">30</span><span class="o">];</span>
<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">vegetables</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">vegetables</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Corn</span><span class="o">();</span>
    <span class="n">vegetables</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Carrot</span><span class="o">();</span>
    <span class="n">vegetables</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Potato</span><span class="o">();</span>
<span class="o">}</span>
<span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">vegetables</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span>
<span class="nc">Potato</span> <span class="n">potato</span><span class="o">;</span>
<span class="k">while</span><span class="o">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">potato</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Potato</span><span class="o">)</span><span class="n">vegetable</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
    <span class="n">potato</span><span class="o">.</span><span class="na">peel</span><span class="o">();</span>
	<span class="n">index</span><span class="o">--;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>How many different structures can the keyword <code>final</code> be applied to in
Java, and what does <code>final</code> mean in each case?</p>
</li>
<li>
<p><a id="instanceofExercise"></a> Assume that <code>Quicksand</code> is a child class of <code>Danger</code>.</p>
<div class="paragraph">
<p>What’s the output of the following code and why?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Quicksand</span> <span class="n">quicksand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Quicksand</span><span class="o">();</span>
<span class="k">if</span><span class="o">(</span><span class="n">quicksand</span> <span class="k">instanceof</span> <span class="nc">Danger</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Run for your lives!"</span><span class="o">);</span>
<span class="k">if</span><span class="o">(</span><span class="n">quicksand</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span> <span class="o">==</span> <span class="nc">Danger</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Run even faster!"</span><span class="o">);</span>
<span class="k">if</span><span class="o">(</span><span class="n">quicksand</span> <span class="k">instanceof</span> <span class="nc">Quicksand</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"The more you struggle, the faster you'll sink!"</span><span class="o">);</span>
<span class="k">if</span><span class="o">(</span><span class="n">quicksand</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span> <span class="o">==</span> <span class="nc">Quicksand</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"You'll need to find a vine to escape!"</span><span class="o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="polymorphismExceptionsExercise"></a> Consider the following two classes.
What’s the problem that prevents compilation?</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Snake</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">BiteException</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"You handled a snake!"</span><span class="o">);</span>
		<span class="k">if</span><span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="o">)</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">BiteException</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cobra</span> <span class="kd">extends</span> <span class="nc">Snake</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">BiteException</span><span class="o">,</span> <span class="nc">PoisonException</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"You handled a cobra!"</span><span class="o">);</span>
		<span class="k">if</span><span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span><span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mf">0.2</span><span class="o">)</span>
				<span class="k">throw</span> <span class="k">new</span> <span class="nf">PoisonException</span><span class="o">();</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">BiteException</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Update the solution from <a href="chap11.html#_solution_boolean_circuits">Section 11.5</a> so that it uses as
many of the inheritance tools from this chapter as possible.  Clearly, the
<code>Gate</code>, <code>UnaryOperator</code>, and <code>BinaryOperator</code> classes should be marked
<code>abstract</code>.  Which methods should be <code>abstract</code>?  Which methods or classes
should be <code>final</code>?</p>
</li>
<li>
<p>Implement a program to assess income tax on normal employees,
students, and international students using a class hierarchy. Normal
employees pay a 6.2% social security tax and a 1.45% Medicare tax every
year, but neither kind of student pays these taxes. All three groups pay
normal income tax according to the following table.</p>
<table class="tableblock frame-all grid-all fit-content center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Marginal Tax Rate</th>
<th class="tableblock halign-center valign-top">Income Bracket</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$0 - $9,700</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$9,701 - $39,475</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">22%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$39,476 - $84,200</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">24%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$84,201 - $160,725</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">32%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$160,726 - $204,100</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">35%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$204,101 - $510,300</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">37%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$510,301+</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Tax is assessed at a given rate for every dollar in the range. For
example, if someone makes $35,000, she pays 10% tax on the first $9,700
of her income and 12% on the remaining $25,300. The exception is
international students whose country has a treaty with the U.S. so that
they don’t have to pay tax on the first $50,000 of income.</p>
</div>
</li>
<li>
<p><a id="atomicClassExercise"></a> Re-implement the original
<code>SynchronizedAccount</code> class from <a href="chap14.html#bankAccountExample">Example 14.2</a> using
atomic classes. For simplicity, you can change the <code>balance</code> type from
<code>double</code> to <code>AtomicInteger</code> since there’s no <code>AtomicDouble</code> class. How
much has this simplified the implementation? Is the <code>readers</code> field
still necessary? Why or why not?</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p><a id="atomicTimingExercise"></a> Take <a href="chap17.html#NoRaceConditionProgram">Program 17.4</a>
and increase <code>COUNT</code> to <code>100000000</code>. Run it several times and time how
long it takes to run to completion.</p>
<div class="paragraph">
<p>Then, take <a href="chap14.html#RaceConditionProgram">Program 14.1</a> and increase its <code>COUNT</code> to
<code>100000000</code> as well. Change the body of the <code>for</code> loop inside the
<code>run()</code> method so that <code>count++;</code> is inside of a <code>synchronized</code> block
that uses <code>RaceCondition.class</code> as the lock. (The choice of
<code>RaceCondition.class</code> is arbitrary, but it’s an object that all the
threads can see.) In this way, the increment will occur atomically,
since only the thread that has acquired the <code>RaceCondition.class</code> lock
will be able to do the operation. Now, run this modified program several
times and time it.</p>
</div>
<div class="paragraph">
<p>How different are the running times? They might be similar, depending on
the implementation of locks and CAS on your OS and hardware platform.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div></div>

<nav>
  <a rel="prev" href="chap16.html" class="nav nav-prev" title="Previous page" aria-label="Previous page" aria-keyshortcuts="Left">
        <i class="fa fa-angle-left"></i>
     </a>
  <a rel="next" href="chap18.html" class="nav nav-next" title="Next page" aria-label="Next page" aria-keyshortcuts="Right">
        <i class="fa fa-angle-right"></i>
     </a>
  <div style="clear: both"></div>
</nav>
<div id="footer">
<div id="footer-text">
Last updated 2024-05-22 11:27:29 -0400
</div>
</div>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-VEDGKRPMMK"></script>
          <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-VEDGKRPMMK');
          </script>

</body>
  <script>
  function isInViewport(ele) {
    const rect = ele.getBoundingClientRect();
    return (
        rect.top >= 0 &&
        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight)
    );
  }
  function yPosition (ele) {
    const rect = ele.getBoundingClientRect();
    return (rect.top - 20); // 20px above
  }
  let curr = document.getElementsByClassName('current');
  if (!isInViewport(curr[curr.length - 1])) {
    document.getElementById('toc').scrollTo({
      top: yPosition(curr[0]),
      left: 0,
      behavior: 'smooth'
    });
  }

  /* For page navigation */
  function gotoPage(selector) {
    const button = document.querySelector(selector);
    if (button)
      window.location.href = button.href;
  }
  document.addEventListener('keydown', e => {
    if (e.shiftKey)
      return;
    switch (e.key) {
      case 'ArrowRight':
        e.preventDefault();
        gotoPage('.nav-next');
        break;
      case 'ArrowLeft':
        e.preventDefault();
        gotoPage('.nav-prev');
        break;
    }
  });
  </script>
  </html>